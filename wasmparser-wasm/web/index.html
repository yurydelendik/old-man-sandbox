<html>

<body>
    <script>
        const testWasmPath = "./test.wasm";
        const wasmdistPath = "./wasmdis.wasm";
        var memory, data;
        var utf8Decoder = new TextDecoder('utf-8');
        var imports = {
            env: {
                jslog: function (p, len) {
                    var text = utf8Decoder.decode(new Uint8Array(memory.buffer, p, len));
                    console.log(text);
                },
            }
        };
        fetch(testWasmPath).then(req => req.arrayBuffer())
            .then(buffer => {
                data = new Uint8Array(buffer);
                return WebAssembly.instantiateStreaming(fetch(wasmdistPath), imports);
            })
            .then(({ instance, }) => {
                memory = instance.exports.memory;
                var p = instance.exports.alloc(data.length);
                new Uint8Array(memory.buffer, p, data.length).set(data);
                instance.exports.parse(p, data.length);
                instance.exports.dealloc(p, data.length);
            });
    </script>
</body>

</html>